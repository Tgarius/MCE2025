!function(){"use strict";var e={20:function(e,t,r){var o=r(609),n=Symbol.for("react.element"),a=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),s=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function i(e,t,r){var o,i={},l=null,d=null;for(o in void 0!==r&&(l=""+r),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,o)&&!c.hasOwnProperty(o)&&(i[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps)void 0===i[o]&&(i[o]=t[o]);return{$$typeof:n,type:e,key:l,ref:d,props:i,_owner:s.current}}t.jsx=i,t.jsxs=i},609:function(e){e.exports=window.React},848:function(e,t,r){e.exports=r(20)}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,r),a.exports}var o,n,a,s=r(848);!function(e){e.CARD="CARD",e.CVV="CARD_CVV",e.DATE="CARD_DATE",e.NUMBER="CARD_NUMBER",e.POSTAL_CODE="CARD_POSTAL_CODE",e.STREET_ADDRESS="CARD_STREET_ADDRESS",e.PAYMENT_REQUEST_BUTTON="PAYMENT_REQUEST_BUTTON"}(o||(o={})),function(e){e.NUMBER="weeconnectpay-card-number",e.DATE="weeconnectpay-card-date",e.CVV="weeconnectpay-card-cvv",e.ZIP="weeconnectpay-card-postal-code",e.PAYMENT_REQUEST_BUTTON="weeconnectpay-payment-request-button"}(n||(n={})),function(e){e.NUMBER="weeconnectpay-card-number-errors",e.DATE="weeconnectpay-card-date-errors",e.CVV="weeconnectpay-card-cvv-errors",e.ZIP="weeconnectpay-card-postal-code-errors",e.PAYMENT_REQUEST_BUTTON="weeconnectpay-payment-request-button-errors"}(a||(a={}));var c=r(609),i=window.wc.wcSettings,l=window.wc.wcBlocksRegistry,d=window.wp.htmlEntities,p=window.wp.i18n;class u{constructor(e){this.getLocalizedCvvPlaceholderStyles=e=>{let t={};if("fr-CA"===e){const e=document.getElementById(n.CVV);e?t=e.offsetWidth>=106||0===e.offsetWidth?{whiteSpace:"pre-line",position:"relative"}:{whiteSpace:"pre-line",position:"relative",top:"-7px"}:console.warn("WeeConnectPay could not detect the CVV element during Styles creation. CVV Element placeholder may look off-center depending on your locale.")}else t={};return t},this.cloverConfig=e,this.verifyCloverSdkIsLoaded(),this.getPakmsOrFail(e.pakms),this.cloverInstance=this.createCloverInstance(e.pakms,e.locale,e.merchantId)}static getInstance(e){if(!this.instance){if(!e)throw console.error("Clover settings must be provided for initialization."),new Error("Clover settings must be provided for initialization.");this.instance=new u(e)}return this.instance}createCloverInstance(e,t,r){try{return new Clover(e,{locale:t,merchantId:r})}catch(e){const t=`WeeConnectPay failed to initialize Clover instance: ${e.message}`;throw console.error(t),new Error(t)}}getCloverInstance(){return this.cloverInstance}verifyCloverSdkIsLoaded(){if("undefined"==typeof Clover)throw new Error("Clover SDK is not loaded.")}getPakmsOrFail(e){if(!e||""===e.trim()){const e="WeeConnectPay Gateway for WooCommerce Blocks cannot load the Clover iframes. Reason: Missing Clover public merchant (pakms) key, is the merchant authenticated?";throw console.error(e),new Error(e)}return e}static getWrapperId(e){switch(e){case o.NUMBER:return n.NUMBER;case o.DATE:return n.DATE;case o.CVV:return n.CVV;case o.POSTAL_CODE:return n.ZIP;case o.PAYMENT_REQUEST_BUTTON:return n.PAYMENT_REQUEST_BUTTON;default:return}}static getErrorDisplayId(e){switch(e){case o.NUMBER:return a.NUMBER;case o.DATE:return a.DATE;case o.CVV:return a.CVV;case o.POSTAL_CODE:return a.ZIP;case o.PAYMENT_REQUEST_BUTTON:return a.PAYMENT_REQUEST_BUTTON;default:return}}getDefaultStyles(){const e=this.getLocalizedCvvPlaceholderStyles(this.cloverConfig.locale);return{input:{padding:"0px",margin:"0px",height:"3.4em",width:"100%",border:"1px #C8C8C8 solid",borderRadius:"3px",textAlign:"center"},"::-webkit-input-placeholder":{textAlign:"center"},"::-moz-placeholder":{textAlign:"center"},":-ms-input-placeholder":{textAlign:"center"},":-moz-placeholder":{textAlign:"center"},"card-cvv input::-webkit-input-placeholder":e,"card-cvv input::-moz-placeholder":e,"card-cvv input:-ms-input-placeholder":e,"card-cvv input:-moz-placeholder":e}}createElements(e){const t=this.cloverInstance.elements(),r={};return e.forEach((([e,o])=>{const n={...this.getDefaultStyles(),...o};try{r[e]=t.create(e,n)}catch(t){console.error(`Error creating element for type ${e}:`,t)}})),r}mountElements(e){Object.entries(e).forEach((([e,t])=>{const r=e,o=u.getWrapperId(r);o&&t.mount&&t.mount("#"+o)}))}static createFinalValidationState(){const e={CARD_NUMBER:{error:"Card number is required",touched:!0},CARD_DATE:{error:"Card expiry is required",touched:!0},CARD_CVV:{error:"Card CVV is required",touched:!0},CARD_POSTAL_CODE:{error:"Card postal code is required",touched:!0}},t=u.getValidationState(),r={};return Object.keys(e).forEach((o=>{const n=o,a=t[n];a&&(a.touched&&!a.error||a.touched&&a.error)?r[n]=a:r[n]=e[n]})),r}attachEventListeners({elements:e,events:t,handler:r}){Object.keys(e).forEach((o=>{const n=e[o];t.forEach((e=>{n.addEventListener(e,r)}))}))}static getValidationState(){return u.validationState}static isFinalEventValid(e){return["CARD_NUMBER","CARD_DATE","CARD_CVV","CARD_POSTAL_CODE"].every((t=>{const r=e[t];return r&&r.touched&&!r.error}))}static isEventElementState(e){return e&&"object"==typeof e&&"touched"in e}static getErrorMessageOrNull(e){const t=["CARD_CVV","CARD_DATE","CARD_NUMBER","CARD_POSTAL_CODE"];let r=!1,n="";return 0===Object.keys(e).length?t.forEach((()=>{r=!0,n+="These fields are required.<br>"})):t.forEach((t=>{const a=e[t];u.isEventElementState(a)&&a.touched?a.error&&(r=!0,n+=`${a.error}<br>`):(r=!0,n+=`${o[t]}: This field is required.<br>`)})),r?n:null}}u.validationState={},u.validationEventHandler=(e,t)=>{"onPaymentSetup"!==t&&(u.validationState={...e}),Object.entries(e).forEach((([e,t])=>{const r=e,o=u.getWrapperId(r),n=u.getErrorDisplayId(r),a=o?document.getElementById(o):null,s=n?document.getElementById(n):null;a&&s?t.error&&t.touched?u.addError(a,s,t.error):t.touched&&u.removeError(a,s):console.error(`WeeConnectPay failed to handle the event for the Clover Iframe element type: ${r}. The wrapperElement or errorDisplayElement were not found. `,{wrapperElement:{id:o,element:a},errorDisplayElement:{id:n,element:s}})}))},u.addError=(e,t,r)=>{t.textContent=r,t.classList.add("error"),e.classList.remove("success"),e.classList.add("error")},u.removeError=(e,t)=>{t.textContent=null,t.classList.remove("error"),e.classList.remove("error"),e.classList.add("success")};var h=u;Error;class E{constructor(e){if(this.googleRecaptchaConfig=e,this.verifyGoogleRecaptchaSdkIsLoaded(),!E.isGoogleRecaptchaEnabled(e.isEnabled))throw console.error("Google Recaptcha is disabled in the settings but is still being constructed."),new Error("Google Recaptcha is disabled in the settings but is still being constructed.");this.getSiteKeyOrFail(e.siteKey)}static getInstance(e){if(!this.instance){if(!e)throw console.error("Clover settings must be provided for initialization."),new Error("Clover settings must be provided for initialization.");this.instance=new E(e)}return this.instance}verifyGoogleRecaptchaSdkIsLoaded(){if("undefined"==typeof grecaptcha)throw console.error("Google Recaptcha SDK is not loaded."),new Error("Google Recaptcha SDK is not loaded.")}static isGoogleRecaptchaEnabled(e){return"1"===e}getSiteKeyOrFail(e){if(!e||""===e.trim()){const e='WeeConnectPay Gateway for WooCommerce Blocks has an error while using Google Recaptcha. Reason: Missing Google Recaptcha "site key". Have you set it up in the plugin settings?';throw console.error(e),new Error(e)}return e}createToken(){return new Promise(((e,t)=>{grecaptcha.ready((()=>{try{grecaptcha.execute(this.googleRecaptchaConfig.siteKey,{action:"submit"}).then((t=>{e(t)}),(e=>{t(e.toString())}))}catch(e){t(e.toString())}}))}))}async getTokenOrExceptionJson(){return await this.createToken()}static getStringifiedErrorForPaymentMethodData(e){const t={exception:e.toString()};return JSON.stringify(t)}}const m="weeconnectpay",v=(0,i.getSetting)("weeconnectpay_data",{}),g=(0,d.decodeEntities)(v.woocommerce?.gateway?.title)||(0,p.__)("Credit Card","weeconnectpay"),f=e=>{const{eventRegistration:t,emitResponse:r}=e,{onPaymentSetup:n}=t;return(0,c.useEffect)((()=>{const e=n((async()=>{const e=h.createFinalValidationState();if(h.validationEventHandler(e,"onPaymentSetup"),!h.isFinalEventValid(e)){const t=h.getErrorMessageOrNull(e);if(null!==t)return{type:r?.responseTypes.ERROR,message:t,messageContext:r?.noticeContexts?.PAYMENTS};{const e="An unexpected validation error has occurred. Please check the console for more details.";return console.error("The final validation before tokenizing the card did not pass validation, but could not generate a proper error message."),{type:r?.responseTypes.ERROR,unhandledValidationErrorMessage:e,messageContext:r?.noticeContexts?.PAYMENTS}}}const t=h.getInstance(v.clover).getCloverInstance();try{var o,n,a,s;let e="";if(E.isGoogleRecaptchaEnabled(v.googleRecaptcha.isEnabled))try{const t=E.getInstance(v.googleRecaptcha);e=await t.getTokenOrExceptionJson()}catch(t){console.error("Error creating Google Recaptcha Token:",t),e=E.getStringifiedErrorForPaymentMethodData(t)}const c=await t.createToken();console.log("Clover Iframe Tokenization Response result: ",c);const i=c.token,l=null!==(o=c.card?.brand)&&void 0!==o?o:"",d=null!==(n=c.card?.exp_month)&&void 0!==n?n:"",p=null!==(a=c.card?.exp_year)&&void 0!==a?a:"",u=null!==(s=c.card?.last4)&&void 0!==s?s:"",h=c.card?.address_zip;return{type:r.responseTypes.SUCCESS,meta:{paymentMethodData:{token:i,"card-brand":l,"card-last4":u,"card-exp-month":d,"card-exp-year":p,"tokenized-zip":h,"recaptcha-token":e}}}}catch(e){return console.error("Error creating Clover token:",e),{type:r?.responseTypes.ERROR,message:"Error creating Clover token",messageContext:r?.noticeContexts?.PAYMENTS}}}));return()=>e()}),[r.responseTypes.ERROR,r.responseTypes.SUCCESS,n]),(0,c.useEffect)((()=>{!function(){try{const e=h.getInstance(v.clover),t=[[o.NUMBER,{}],[o.DATE,{}],[o.CVV,{}],[o.POSTAL_CODE,{}]],r=e.createElements(t);e.mountElements(r),e.attachEventListeners({elements:r,events:["change","blur"],handler:h.validationEventHandler})}catch(e){console.error("WeeConnectPay failed to setup Clover:",e.message)}}()}),[]),(0,s.jsx)("div",{id:"weeconnectpay-wc-fields",children:(0,s.jsxs)("div",{id:"form-display-no-footer",children:[(0,s.jsx)("div",{className:"top-row-wrapper",children:(0,s.jsxs)("div",{className:"form-row top-row full-width",children:[(0,s.jsx)("div",{id:"weeconnectpay-card-number",className:"field card-number-field"}),(0,s.jsx)("div",{className:"input-errors",id:"weeconnectpay-card-number-errors",role:"alert"})]})}),(0,s.jsxs)("div",{className:"bottom-row-wrapper",children:[(0,s.jsxs)("div",{className:"form-row bottom-row third-width",children:[(0,s.jsx)("div",{id:"weeconnectpay-card-date",className:"field card-date-field"}),(0,s.jsx)("div",{className:"input-errors",id:"weeconnectpay-card-date-errors",role:"alert"})]}),(0,s.jsxs)("div",{className:"form-row bottom-row third-width",children:[(0,s.jsx)("div",{id:"weeconnectpay-card-cvv",className:"field card-cvv-field"}),(0,s.jsx)("div",{className:"input-errors",id:"weeconnectpay-card-cvv-errors",role:"alert"})]}),(0,s.jsxs)("div",{className:"form-row bottom-row third-width",children:[(0,s.jsx)("div",{id:"weeconnectpay-card-postal-code",className:"field card-postal-code-field"}),(0,s.jsx)("div",{className:"input-errors",id:"weeconnectpay-card-postal-code-errors",role:"alert"})]})]}),(0,s.jsx)("div",{id:"card-response",role:"alert"}),(0,s.jsx)("div",{id:"card-errors",role:"alert"}),(0,s.jsx)("div",{className:"clover-footer"})]})})},y={name:m,paymentMethodId:m,label:g,content:(0,s.jsx)(f,{emitResponse:()=>{},eventRegistration:()=>{}}),edit:(0,s.jsx)(f,{emitResponse:()=>{},eventRegistration:()=>{}}),canMakePayment:()=>!0,ariaLabel:g,supports:{features:v.woocommerce?.gateway?.supports?v.woocommerce.gateway.supports:["products"]}};(0,l.registerPaymentMethod)(y)}();